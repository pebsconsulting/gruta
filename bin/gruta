#!/usr/bin/perl

use strict;
use warnings;

use Gruta;
use Gruta::Source::DBI;
use Gruta::Source::FS;

my $usage = 0;

my $src;
my $cmd;
my $src_str;

$cmd = shift(@ARGV) or $usage = 1;
$src_str = shift(@ARGV) or $usage = 1;

if ($usage) {
	usage();
	exit 1;
}

$src = new_source($src_str);

if ($cmd eq 'copy') {
	my $dst = new_source(shift(@ARGV));

	$dst->create();

	my $g = Gruta->new( sources => $src );
	$g->transfer_to_source( $dst );
}
else {
	usage();
}

exit 0;


sub usage
{
	print "Usage: $0 {cmd} {source}\n";
}

sub new_source
{
	my $src_str = shift;
	my $src;

	if ($src_str =~ /^dbi:/) {
		$src = Gruta::Source::DBI->new( string => $src_str );
	}
	else {
		$src = Gruta::Source::FS->new( path => $src_str );
	}

	return $src;
}
